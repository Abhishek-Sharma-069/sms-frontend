<!-- Student add/edit form. Reactive Forms with validation. -->
<div class="w-full max-w-160 mx-auto p-6 sm:p-8 box-border">
  <header class="mb-8">
    <a routerLink="/dashboard" class="text-(--sms-secondary) text-[0.875rem] no-underline inline-flex items-center gap-2 mb-4 transition-colors hover:text-(--sms-primary)">
      <i class="bi bi-arrow-left"></i>
      Back to list
    </a>
    <h1 class="text-(--sms-primary) text-2xl font-semibold tracking-tight">{{ isEdit ? 'Edit Student' : 'Add Student' }}</h1>
    <p class="text-(--sms-secondary) mt-1 text-sm">
      {{ isEdit ? 'Update student details.' : 'Fill in the form to add a new student.' }}
    </p>
  </header>

  @if (loadingData) {
    <div class="w-full bg-[rgba(255,255,255,0.9)] border border-(--sms-secondary) rounded-xl text-(--sms-secondary) box-border flex flex-col items-center justify-center py-16">
      <i class="bi bi-arrow-repeat animate-spin text-3xl opacity-70"></i>
      <p class="mt-3 text-sm">Loading…</p>
    </div>
  } @else {
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="bg-white border border-(--sms-secondary) rounded-xl p-6 shadow-[0_2px_8px_rgba(26,50,99,0.08)]">
      @if (error) {
        <div class="bg-[rgba(254,243,199,0.95)] border border-[#d97706] rounded-lg text-[#92400e] p-3 text-[0.875rem] mb-6 flex items-center gap-2">
          <i class="bi bi-exclamation-triangle"></i>
          {{ error }}
        </div>
      }

      <div class="grid gap-6 sm:grid-cols-2">
        <div class="flex flex-col gap-1.5">
          <label for="name" class="text-[0.875rem] font-medium text-(--sms-primary)">Name</label>
          <input
            id="name"
            type="text"
            formControlName="name"
            class="w-full px-3 py-2.5 border border-(--sms-secondary) rounded-lg text-[0.875rem] text-(--sms-primary) box-border transition-all focus:outline-none focus:border-(--sms-accent) focus:ring-2 focus:ring-[rgba(250,185,91,0.35)] placeholder:text-(--sms-secondary) placeholder:opacity-70 disabled:bg-(--sms-bg) disabled:cursor-not-allowed"
            placeholder="e.g. John Doe"
            [class.!border-[#d97706]]="hasError('name', 'required') || hasError('name', 'minlength')"
          />
          @if (hasError('name', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Name is required.</p>
          }
          @if (hasError('name', 'minlength') && !hasError('name', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Name must be at least 2 characters.</p>
          }
        </div>

        <div class="flex flex-col gap-1.5">
          <label for="email" class="text-[0.875rem] font-medium text-(--sms-primary)">Email</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="w-full px-3 py-2.5 border border-(--sms-secondary) rounded-lg text-[0.875rem] text-(--sms-primary) box-border transition-all focus:outline-none focus:border-(--sms-accent) focus:ring-2 focus:ring-[rgba(250,185,91,0.35)] placeholder:text-(--sms-secondary) placeholder:opacity-70 disabled:bg-(--sms-bg) disabled:cursor-not-allowed"
            placeholder="e.g. john&#64;example.com"
            [class.!border-[#d97706]]="hasError('email', 'required') || hasError('email', 'email')"
          />
          @if (hasError('email', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Email is required.</p>
          }
          @if (hasError('email', 'email') && !hasError('email', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Please enter a valid email.</p>
          }
        </div>
      </div>

      <div class="grid gap-6 sm:grid-cols-2 mt-6">
        <div class="flex flex-col gap-1.5">
          <label for="course" class="text-[0.875rem] font-medium text-(--sms-primary)">Course</label>
          <input
            id="course"
            type="text"
            formControlName="course"
            class="w-full px-3 py-2.5 border border-(--sms-secondary) rounded-lg text-[0.875rem] text-(--sms-primary) box-border transition-all focus:outline-none focus:border-(--sms-accent) focus:ring-2 focus:ring-[rgba(250,185,91,0.35)] placeholder:text-(--sms-secondary) placeholder:opacity-70 disabled:bg-(--sms-bg) disabled:cursor-not-allowed"
            placeholder="e.g. Computer Science"
            [class.!border-[#d97706]]="hasError('course', 'required') || hasError('course', 'minlength')"
          />
          @if (hasError('course', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Course is required.</p>
          }
          @if (hasError('course', 'minlength') && !hasError('course', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Course must be at least 2 characters.</p>
          }
        </div>

        <div class="flex flex-col gap-1.5">
          <label for="marks" class="text-[0.875rem] font-medium text-(--sms-primary)">Marks</label>
          <input
            id="marks"
            type="number"
            formControlName="marks"
            class="w-full px-3 py-2.5 border border-(--sms-secondary) rounded-lg text-[0.875rem] text-(--sms-primary) box-border transition-all focus:outline-none focus:border-(--sms-accent) focus:ring-2 focus:ring-[rgba(250,185,91,0.35)] placeholder:text-(--sms-secondary) placeholder:opacity-70 disabled:bg-(--sms-bg) disabled:cursor-not-allowed"
            placeholder="0–100"
            min="0"
            max="100"
            [class.!border-[#d97706]]="hasError('marks', 'required') || hasError('marks', 'min') || hasError('marks', 'max')"
          />
          @if (hasError('marks', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Marks is required.</p>
          }
          @if ((hasError('marks', 'min') || hasError('marks', 'max')) && !hasError('marks', 'required')) {
            <p class="text-[0.8125rem] text-[#92400e] m-0">Marks must be between 0 and 100.</p>
          }
        </div>
      </div>

      <div class="flex flex-col gap-1.5 sm:max-w-xs mt-6">
        <label for="result" class="text-[0.875rem] font-medium text-(--sms-primary)">Result</label>
        <select
          id="result"
          formControlName="result"
          class="w-full px-3 py-2.5 border border-(--sms-secondary) rounded-lg text-[0.875rem] text-(--sms-primary) box-border transition-all focus:outline-none focus:border-(--sms-accent) focus:ring-2 focus:ring-[rgba(250,185,91,0.35)] disabled:bg-(--sms-bg) disabled:cursor-not-allowed"
          [class.!border-[#d97706]]="hasError('result', 'required')"
        >
          <option value="">Select result</option>
          <option value="Pass">Pass</option>
          <option value="Fail">Fail</option>
        </select>
        @if (hasError('result', 'required')) {
          <p class="text-[0.8125rem] text-[#92400e] m-0">Result is required.</p>
        }
      </div>

      <div class="flex flex-wrap gap-3 mt-8">
        <button
          type="submit"
          [disabled]="form.invalid || loading"
          class="inline-flex items-center px-4 py-2.5 bg-(--sms-accent) text-(--sms-primary) border-none rounded-lg text-[0.875rem] font-semibold cursor-pointer shadow-[0_1px_3px_rgba(26,50,99,0.15)] transition-all hover:enabled:bg-[#e5a84a] hover:enabled:-translate-y-px disabled:opacity-60 disabled:cursor-not-allowed"
        >
          @if (loading) {
            <i class="bi bi-arrow-repeat animate-spin mr-2"></i>
          }
          {{ isEdit ? 'Update Student' : 'Add Student' }}
        </button>
        <a routerLink="/dashboard" class="inline-flex items-center px-4 py-2.5 border border-(--sms-secondary) bg-white text-(--sms-primary) rounded-lg text-[0.875rem] font-medium no-underline transition-all hover:bg-(--sms-bg)">Cancel</a>
      </div>
    </form>
  }
</div>
